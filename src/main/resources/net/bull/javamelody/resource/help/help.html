<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><title>Online help of the JavaMelody monitoring</title>
<link rel='stylesheet' href='?resource=monitoring.css' type='text/css'/>
<link type='image/png' rel='shortcut icon' href='?resource=systemmonitor.png' />
</head><body>

<h3 align='center'>Online help of the 
<a href='http://javamelody.googlecode.com' target='_blank'>JavaMelody</a> monitoring</h3>
The JavaMelody monitoring is a tool to measure and calculate statistics on real operation of an application
depending on the usage of the application by the users.
<br/>
The monitoring is mainly based on statistics of requests and on evolution charts.
It allows to improve applications in QA and production and helps to:<ul>
<li>give facts about the average response times and number of executions</li>
<li>make decisions when trends are bad, before problems become too serious</li>
<li>optimize based on the more limiting response times</li>
<li>find the root causes of response times</li>
<li>verify the real improvement after optimizations</li>
</ul>

<h3><img width='16' height='30' src='?resource=help/coffee.png' alt='Docs'/>
Documentations</h3>
<a href='http://java.sun.com/javase/reference/index.jsp' target='_blank'>
Java SE Reference at a Glance</a><br/>
<a href='http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/index.html' target='_blank'>
Troubleshooting Guide for Java SE 6</a><br/>
<a href='http://java.sun.com/javase/6/webnotes/trouble/other/troubleshooting-j2se5.html' target='_blank'>
Troubleshooting Guide for Java SE 5</a><br/>
<a href='http://java.sun.com/developer/technicalArticles/J2SE/monitoring/' target='_blank'>
Monitoring and Managing Java SE 6</a><br/>
<a href='http://java.sun.com/performance/reference/whitepapers/6_performance.html' target='_blank'>
Java SE 6 Performance</a><br/>
<a href='http://java.sun.com/j2se/reference/whitepapers/memorymanagement_whitepaper.pdf' target='_blank'>
Memory Management</a><br/>

<h3><img width='24' height='24' src='?resource=systemmonitor.png' alt='Stats'/>
Summary</h3>
In the page of monitoring, the summary shows evolution charts for several values of measures.<br/>
These measures are taken at a time T, for example every 2 minutes.
Each chart follows the evolution of a value of measure on the period short or large chosen
with the links above the summary: <img width='16' height='16' src='?resource=calendar_view_day.png' alt='day'/> the day,
 <img width='16' height='16' src='?resource=calendar_view_week.png' alt='week'/> the week,
 <img width='16' height='16' src='?resource=calendar_view_month.png' alt='month'/> the month or 
 <img width='16' height='16' src='?resource=calendar.png' alt='year'/> the year.
In each chart, the mean value in green and the maximum in blue are displayed with numbers below the chart.
Charts are persisted: a restart of the application server has no influence on them except of a hole in the measures.<br/>
Each chart can be zoomed and resized by clicking on them in the summary.<br/><br/>

The charts displayed are:<ul>
<li>the java memory used, between 0 and the maximum set by Xmx in the server configuration</li>
<li>the cpu percentage used by the java process, between 0 and 100 even if there are several cores or several processors</li>
<li>the number of http sessions (or number of connected users)</li>
<li>if linux: the system load, the cpu percentage of the garbage collector and the number of opened files</li>
<li>the number of active threads (or number of current http requests)</li>
<li>the number of active jdbc connections (or number of current sql requests)</li>
<li>the number of used jdbc connections (or number of opened sql transactions);
  in the case where there is no datasource, it is in fact the number of opened jdbc connections in the connections pool</li>
<li>for each counter of requests (http, sql and possibly ejb or spring) :<ul>
	<li>the number of hits per minute (or number of executions of requests per minute)</li>
	<li>the mean time in milliseconds</li>
	<li>the percentage of system errors
	(these values for a counter are a mean for the last period of measure)</li>
	</ul>
</li></ul>

The link '<img width='16' height='16' src='?resource=action_refresh.png' alt='Update'/> Update' refreshes the page and the charts.
The link '<img width='16' height='16' src='?resource=pdf.png' alt='PDF'/> PDF' displays the report in PDF format for Adobe Reader.<br/>
If a collect server is used to display the monitoring of several servers in a farm or in a cluster,
the chart of the memory is the sum of the memories in each server,
but the cpu percentage is between 0 and 100 for all servers,
and the number of http sessions is the sum of sessions in each servers,
as are the number of active threads, the number of active or used jdbc connections,
and the number of hits per minute or the mean time in milliseconds.

<h4>Memory chart: use case of an application used intermittently (day/night for example)</h4>
<img src='?resource=help/usedMemory.png' alt='Memory' />
<p>The memory in the chart increases rapidly when the application is used,
and it increases slowly but still increases when the application is not used.
A chart with slopes, as in the above example, is classic even if the application is not used.<br/>
In all cases and as needed, the memory is finally released at once by the garbage collector
(major GC) and goes to a low level, before rising again rapidly or slowly.
If the resolution set is sufficiently fine, the chart also shows the minor GCs
 as small sawtooth between the major GCs.
These minor GCs release also some memory but in less quantity than the major GCs.
It is possible to force a major GC with the action 
'<img src='?resource=broom.png' width='16' height='16' alt='Garbage collector' /> Execute the garbage collector'
 in the part '<img width='16' height='16' src='?resource=systeminfo.png' alt='System informations'/> System informations' of the report.</p>

<h4>Memory chart: use case of a memory saturation</h4>
If the memory in the chart increases to the maximum and if the application can not release some of it with the garbage collector,
the server possibly causes some OutOfMemoryErrors to interrupt the execution and to release some memory if possible.<br/>
Until the memory is sufficient, the cpu remains at 100% because the garbage collector runs permanently.
This can cause extreme slowness or a blocking of the application server.<br/>
The solutions can be to increase the maximum java memory (parameter Xmx in configuration of server),
and possibly the physical memory of the server, or to optimize if possible the memory used by the application.

<h4>Charts of active threads and of active jdbc connections: use case of a flat level (long requests)</h4>
<a href='?resource=help/activeThreads.png' target='_blank'><img src='?resource=help/activeThreads.png' alt='Active threads' width='312' height='147' /></a>
<p>When a application is sparsely or not used, the charts of active threads and of active jdbc connections stay at 0.
Indeed, most requests are fortunately short and most measures (done each 2 minutes for example)
are taken without active requests, except 1 or 2 occasionally shown as a peak.</p>
But, when there is a flat level in the chart of active threads like in the example above,
this means that there is one or several requests which are long (several minutes or several hours)
and which potentially saturate the application server or the database.<br/>
To find the cause:<ul>
<li>If the flat level of active threads is reproduced exactly in active jdbc connections,
 this shows that the cause is in one or several sql request(s) and not in the execution of java code.</li>
<li>If the flat level(s) continues currently, you can find the http (and sql) requests involved
 in the '<img width='16' height='16' src='?resource=hourglass.png' alt='Current requests'/> Current requests' part of the report.</li>
<li>If the flat level(s) has ended, you can find the statistics of http (and sql) requests involved,
 in the detailed tables of '<img width='16' height='16' src='?resource=dbweb.png' alt='http'/> Http (and sql) statistics',
 except if the application server has been stopped before the end of these requests.</li>
<li>The drill-down display in the detail of an http request can help you to find the root cause in the façades or the sql requests.</li>
<li>It can be useful to check with the monitoring the state of the memory and the cpu used by the application server.
 It can also be useful to check on your own the state of the memory, of the cpu and of disk access of your database.</li>
</ul>
<h3><img width='24' height='24' src='?resource=dbweb.png' alt='Stats'/>
Statistics</h3>
The statistics of a counter shows the statistics of the requests executed on the application server.<br/>
4 counters of requests exist today:<ul>
<li><img width='24' height='24' src='?resource=dbweb.png' alt='http'/>
Http statistics</li>
<li><img width='24' height='24' src='?resource=db.png' alt='sql'/>
Sql statistics (jdbc)</li>
<li><img width='24' height='24' src='?resource=beans.png' alt='ejb'/>
Ejb statistics (if ejb3 façades on JavaEE 5)</li>
<li><img width='24' height='24' src='?resource=beans.png' alt='spring'/>
Spring statistics (if spring façades)</li>
</ul>
For each counter, a request appears in the statistics when it is finished;
to know the unfinished requests see the 
'<img width='16' height='16' src='?resource=hourglass.png' alt='Current requests'/> Current requests' part of the report.<br/>
As for the charts, the statistics of requests are for the period small or large chosen with the
links above the charts: the day (since 0h), the week, the month or the year.
So it is possible to see the statistics for only the current day, or for example for a version
of the application deployed since a month without the statistics of previous versions.<br/>
And for each counter, the report shows a summary of statistics for all the requests (global),
of the statistics going beyond the threshold of alert level 1 (warning)
and of those going beyond the threshold of alert level 2 (severe).
The details of the statistics for each request are displayed by clicking the link '+ Details'.<br/><br/>
Each statistic of request shows:<ul>
<li>the content of the request</li>
<li>an evolution chart for mean times of this request in tooltip for the same period as the statistics;
this chart can be zoomed by clicking on the content of the request</li>
<li>the percentage of cumulated time (mean time * nb of hits) compared to other requests</li>
<li>the number of hits (or number of executions)</li>
<li>the mean time in milliseconds</li>
<li>the maximum time in milliseconds</li>
<li>the standard deviation between execution times:
if it is high, the execution times are varied, and if it is low the execution times are closed to one another</li>
<li>the percentage of system errors</li>
</ul>
and if it is an http statistic:<ul>
<li>the mean size in kilo-bytes of the response stream</li>
<li>the mean number of sql hits, by execution of http request</li>
<li>the mean time executing sql requests, by execution of http request</li>
</ul>

Like all tables of the report, the tables of statistics can be ordered in ascending or descending order by clicking on headers of columns.<br/>
The statistics are persisted for each counter: a restart of the application server has no influence on them.<br/>
If a collect server is used to display the monitoring of several servers in a farm or in a cluster,
the statistics of counters are global for all servers.<br/><br/>
Note: In MS Windows (except Vista), the clock resolution used is about 16 ms (either 0, either 16, or 32 ms).
So the time of an execution is not accurate below 16 ms with Windows.
This is in part corrected by use of a mean when there are sufficient executions.
But this is not grave because in general, the problematic requests will have an execution time much longer than 16 ms.<br/>

<h3><img width='24' height='24' src='?resource=error.png' alt='Http system errors'/>
Statistics of http system errors</h3>
The statistics of http system errors shows the errors which come back to the http filter of the
monitoring, either by exceptions thrown by the application via a servlet,
either by an http error code (404 "not found" or 500 "internal server error" for example,
<a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank">complete list</a>).
These statistics display the list of the 250 most frequent system errors with the number of cases
of each error on the chosen period, and with the mean time of the request for each error.
Only the most frequent error is displayed initially, the other errors being displayed by clicking the link '+ Details'.
The dates, hours, users and complete http requests of the last 100 errors are displayed by clicking the link '+ Last errors'.
By clicking on the name of an error, it is possible to see for this error the evolution chart of the
number of cases over time and the java stack-trace of the error when it is a java exception.
<br/>These statistics of errors allow to improve the reliability of the application based on its real usage in production.

<h3><img width='24' height='24' src='?resource=log.png' alt="System errors logs"/>
Statistics of system errors logs</h3>
The statistics of system errors logs show the 'warning' and 'error' logs written by the application
(the libraries log4j of apache and java.util.logging of the jdk are both supported).
These statistics display the list of the 500 most frequest errors logs with the number of
cases of each error on the chosen period.
Only the most frequent error log is displayed initially, the other logs being displayed by clicking the link '+ Details'.
The dates, hours, users and where appropriate the complete http requests of the last 100 errors logs
are displayed by clicking the link '+ Last errors'.
By clicking on the name of an error log, it is possible to see for this log the evolution chart of
the number of cases over time and the java stack-trace of the error when a java exception has been
written in the log.
<br/>These statistics of errors logs allow equally to improve the reliability of the application
based on its real usage in production.

<h3><img width='24' height='24' src='?resource=hourglass.png' alt='Current requests'/>
Current requests</h3>
The current requests shows at the moment of the generation of the report the executions of not ended requests.<br/>
The tree of http requests, possibly ejb, spring and/or sql is displayed with for each of the requests
 the time elapsed already, the cpu time elapsed, the number of sql requests already executed and the sql time of these requests.<br/>
The global statistics of the requests are displayed again for the current requests:
 mean time, mean cpu time, mean sql hits and mean sql time.
It allows to compare the current requests with the global statistics.<br/>
The current java stack-trace is displayed by a tooltip on the thread (if jdk 1.6).<br/>
Only the longest request is displayed initially, the others are displayed by clicking on the link '+ Details'.<br/>

<h3><img width='24' height='24' src='?resource=systeminfo.png' alt='System informations'/>
System informations</h3>
The system informations display at the moment of the generation of the report some informations on the java server,
its state and on the operating system of the server.<br/>
The main informations displayed initially are:
 used java memory, number of http sessions, number of active threads, number of active jdbc connections
 and number of used jdbc connnections.
These are the same values which are used for the charts.<br/>
The other informations, such as the version of the server, of the operating system or of the database
 or the memory of the operating system, are displayed by clicking on the links '+ Details'.<br/>
<br/>
In this part of the system informations, some links allow to run the system actions:<ul>
<li><img src='?resource=broom.png' width='20' height='20' alt='Garbage collector' />
'Execute the garbage collector', to force a release of memory</li>
<li><img src='?resource=heapdump.png' width='20' height='20' alt='Heap dump' />
If jdk 1.6, 'generate a heap dump',
 to dump all the content of the memory in a file of the temporary directory on the server,
 which you can open with <a href="http://visualvm.dev.java.net" target="_blank">VisualVM</a> of the JDK
 or with <a href="http://www.eclipse.org/mat/" target="_blank">Eclipse MAT</a></li>
<li><img src='?resource=user-trash.png' width='18' height='18' alt='Invalidate http sessions' />
'Invalidate http sessions', to force all users to disconnect</li>
<li><img src='?resource=system-users.png' width='20' height='20' alt='Sessions' />
'View http sessions', to see the attributes, the serialized sizes
 (generally higher than the sizes in memory), the country and possibly the user of each session
 (if authentication by JavaEE)</li>
<li><img src='?resource=memory.png' width='20' height='20' alt='Memory histogram' />
If jdk 1.6, 'view memory histogram', to display the number of instances in memory for each java class</li>
<li><img src='?resource=xml.png' width='20' height='20' alt='web.xml' />
'View deployment descriptor' : web.xml file of the application</li>
<li><img src='?resource=threads.png' width='20' height='20' alt='Processus' />
'View OS processes' : list of processes of the operating system (linux with
<a href='http://en.wikipedia.org/wiki/Ps_(Unix)' target='_blank'>ps</a> or windows with tasklist)
and for each process: user, memory and cpu</li>
<li><img src='?resource=db.png' width='20' height='20' alt='Database' />
'Database' : Informations and statistics on the database (if postgresql, mysql or oracle),
like for example the current sql requests or if oracle, the longest requests in cumulative time with
display of the cpu time and of the elementary cost (of buffer gets).
This function will display an error if the user configured in the application to connect to the
database does not have the necessary rights. With oracle, the following request grants this right:
"grant select any dictionary to myuser".</li>
</ul>
If a collect server is used to display the monitoring of several servers in a farm or in a cluster,
the system informations of each server are displayed (aggregated for the list of sessions and for
the memory histogram) and the actions are executed on each server one at a time.

<h3><img width='24' height='24' src='?resource=threads.png' alt='Threads'/>
Threads</h3>
This table displays the list of all threads in the server, with for each the priority, the state
and the stack-trace in a tooltip (if jdk 1.6) among other.

<h3><img width='24' height='24' src='?resource=caches.png' alt='Caches of data'/>
Caches of data</h3>
The caches of data display the list of caches in the java application provided that the library
<a href="http://ehcache.sourceforge.net" target="_blank">ehcache</a> is used for them.<br/>
For each of the caches, some statistics are displayed:
the number of objects in memory and on disk at the moment, the efficiency of the memory cache
(percentage since the start of the server of the memory cache hits compared to the disk cache hits),
the global cache efficiency (percentage of the memory cache or disk cache hits compared to all cache access
including misses for data not in cache).
The configuration of each cache is also displayed for information.

<h3>Language</h3>
The monitoring is displayed in French or in English depending of the preferred language in your browser.
If the monitoring is in French language instead of being in English language, you should modify the preferred language.
For example, in <a href="http://www.mozilla.com/firefox" target="_blank">Firefox</a>,
open the menu and popup "Tools, Options, Content, Language ... Choose" and move "Anglais [en]" to the first place:
<br/><br/>
<div align='center'><a href='?resource=help/language.png' target='_blank'>
<img src='?resource=help/language.png' alt='langue' width='25%' height='25%' /></a></div>

<br/><br/>

<h3>Icons credits</h3>
<a href='http://www.famfamfam.com/'>Silk, mini and flag icons (Creative Commons)</a>
<br/><br/>
<a href='http://tango.freedesktop.org/Tango_Icon_Library'>Tango icons (GPL)</a> 
</body></html>
